# نظام إدارة طلبات المواد - PRD

## المشكلة الأصلية
نظام لمدير مشتريات يتيح لـ 10 مشرفين مواقع إنشاء طلبات مواد، ثم يعتمدها 6 مهندسين، وأخيراً يصل الطلب لمدير المشتريات لإصدار أمر الشراء للموردين.

## المتطلبات المنفذة (28 ديسمبر 2025)

### ✅ المصادقة والمستخدمين
- تسجيل دخول/تسجيل جديد مع JWT
- 4 أدوار: مشرف (supervisor)، مهندس (engineer)، مدير مشتريات (procurement_manager)، موظف طباعة (printer)
- حماية المسارات حسب الدور

### ✅ لوحة تحكم المشرف
- إحصائيات الطلبات (إجمالي، معلقة، معتمدة، مرفوضة)
- إنشاء طلب مواد جديد **متعدد الأصناف** (اسم المادة، الكمية، الوحدة، المشروع، السبب)
- اختيار المهندس من قائمة
- تعديل الطلب قبل الاعتماد
- عرض جميع طلباته
- تصدير PDF

### ✅ لوحة تحكم المهندس
- عرض الطلبات المعلقة للاعتماد
- اعتماد أو رفض الطلبات مع سبب الرفض
- عرض الطلبات السابقة
- تصدير PDF

### ✅ لوحة تحكم مدير المشتريات
- عرض الطلبات المعتمدة من المهندسين
- **إصدار أوامر شراء متعددة للطلب الواحد** (اختيار الأصناف لكل مورد)
- **اعتماد أوامر الشراء** قبل إرسالها للطباعة
- عرض أوامر الشراء بحسب الحالة (بانتظار الاعتماد / معتمدة / مطبوعة)
- فلترة حسب التاريخ
- تقارير PDF حسب الفترة الزمنية

### ✅ لوحة تحكم موظف الطباعة (جديد)
- عرض أوامر الشراء المعتمدة فقط
- **طباعة أمر الشراء** (تصدير PDF + تسجيل الطباعة)
- عرض الأوامر المطبوعة سابقاً
- إحصائيات (بانتظار الطباعة / تمت طباعتها)

### ✅ الواجهة
- تصميم عربي RTL بالكامل
- متجاوب مع الجوال
- خط Cairo العربي
- ألوان: Slate + Safety Orange
- مكونات Shadcn UI

### ✅ تصدير PDF
- تصدير طلب مواد فردي
- تصدير أمر شراء فردي
- تصدير قائمة الطلبات
- تصدير قائمة أوامر الشراء (تقارير)

## الميزات المؤجلة (P1)
- إشعارات البريد الإلكتروني (SendGrid جاهز، يحتاج API key)
- تحليلات متقدمة (إنفاق لكل مشروع، المواد الأكثر طلباً)
- إشعارات فورية Push Notifications

## سير العمل الكامل
```
مشرف: ينشئ طلب متعدد الأصناف
    ↓
مهندس: يعتمد أو يرفض الطلب
    ↓
مدير مشتريات: يصدر أوامر شراء (يختار الأصناف لكل مورد)
    ↓
مدير مشتريات: يعتمد أوامر الشراء
    ↓
موظف طباعة: يطبع أوامر الشراء المعتمدة
```

## الهيكل التقني
- Backend: FastAPI + MongoDB
- Frontend: React + Tailwind + Shadcn UI
- Auth: JWT tokens
- PDF: jsPDF + jsPDF-AutoTable

## بيانات الاختبار
| الدور | البريد الإلكتروني | كلمة المرور |
|-------|-----------------|-------------|
| مشرف | supervisor1@test.com | 123456 |
| مهندس | engineer1@test.com | 123456 |
| مدير مشتريات | manager1@test.com | 123456 |
| موظف طباعة | printer1@test.com | 123456 |

## API Endpoints
- `POST /api/auth/register` - تسجيل مستخدم جديد
- `POST /api/auth/login` - تسجيل الدخول
- `GET /api/requests` - جميع الطلبات
- `POST /api/requests` - إنشاء طلب جديد
- `PUT /api/requests/{id}` - تعديل طلب
- `POST /api/requests/{id}/approve` - اعتماد طلب
- `POST /api/requests/{id}/reject` - رفض طلب
- `GET /api/requests/{id}/remaining-items` - الأصناف المتبقية
- `POST /api/purchase-orders` - إصدار أمر شراء (مع اختيار الأصناف)
- `GET /api/purchase-orders` - جميع أوامر الشراء
- `PUT /api/purchase-orders/{id}/approve` - اعتماد أمر الشراء
- `PUT /api/purchase-orders/{id}/print` - تسجيل طباعة أمر الشراء
